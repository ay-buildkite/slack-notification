---
steps:
  - label: FAIL
    command: exit 1
    key: main-step
    soft_fail:
      - exit_status: 1
  - label: ':bell: :hammer: Build a notify pipeline'
    depends_on: main-step
    command: |-
      if [ $$(buildkite-agent step get "outcome" --step "fail") == "failed" ]; then
        cat <<- YAML | buildkite-agent pipeline upload
        steps:
          - label: ":mouth: Yell at everyone"
            notify:
            - slack: '@amaury'
                message: "You have failed me."
      YAML
      else
        cat <<- YAML | buildkite-agent pipeline upload
        steps:
          - label: ":tada: WIN"
            notify:
            - slack: '@amaury'
              message: "Not failing is good enough. "
      YAML
      fi
